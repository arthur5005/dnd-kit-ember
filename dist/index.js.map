{"version":3,"file":"index.js","sources":["../src/modifiers/registries.ts","../src/modifiers/draggable.ts","../src/modifiers/droppable.ts","../src/modifiers/sortable.ts","../src/modifiers/handle.ts","../src/components/drag-drop.gts"],"sourcesContent":["import type { Draggable, Sortable } from '../types.ts';\n\nexport const draggableRegistry = new Map<string, Draggable | Sortable>();\nexport const handleRegistry = new Map<string, HTMLElement>();\n","import { registerDestructor } from '@ember/destroyable';\nimport Modifier from 'ember-modifier';\n\nimport type Owner from '@ember/owner';\nimport type { Data, DraggableInput, UniqueIdentifier } from '../types.ts';\nimport { DragDropManager, Draggable } from '../types.ts';\nimport { guidFor } from '@ember/object/internals';\nimport { draggableRegistry, handleRegistry } from './registries.ts';\n\nexport interface DraggableModifierSignature<T extends Data = Data> {\n  Args: {\n    Named: Omit<DraggableInput<T>, 'element'>;\n  };\n  Element: HTMLElement;\n}\n\nexport class DraggableModifier<T extends Data = Data> extends Modifier<\n  DraggableModifierSignature<T>\n> {\n  private manager: DragDropManager;\n  private draggable?: Draggable<T>;\n  private currentId?: UniqueIdentifier;\n\n  constructor(owner: Owner, manager: DragDropManager) {\n    super(owner, {} as never);\n    this.manager = manager;\n    registerDestructor(this, this.cleanup.bind(this));\n  }\n\n  get key() {\n    if (!this.currentId) {\n      return '';\n    }\n\n    const managerId = guidFor(this.manager);\n    return `${managerId}_${this.currentId}`;\n  }\n\n  modify(\n    element: HTMLElement,\n    _positional: [],\n    named: DraggableModifierSignature<T>['Args']['Named'],\n  ) {\n    this.currentId = named.id;\n\n    if (this.draggable) {\n      this.draggable.id = named.id;\n      this.draggable.element = element;\n      this.draggable.handle = named.handle ?? handleRegistry.get(this.key);\n      this.draggable.type = named.type;\n      this.draggable.feedback = named.feedback ?? 'default';\n      this.draggable.disabled = !!named.disabled;\n      this.draggable.sensors = named.sensors;\n\n      if (named.data) {\n        this.draggable.data = named.data;\n      }\n    } else {\n      this.draggable = new Draggable(\n        { element, handle: handleRegistry.get(this.key), ...named },\n        this.manager,\n      );\n      draggableRegistry.set(this.key, this.draggable);\n    }\n  }\n\n  private cleanup() {\n    if (this.draggable) {\n      draggableRegistry.delete(this.key);\n\n      this.draggable.destroy();\n      this.draggable = undefined;\n    }\n  }\n}\n\nexport function createDraggableModifier(\n  manager: DragDropManager,\n): typeof DraggableModifier<Data> {\n  return class BoundDraggableModifier extends DraggableModifier {\n    constructor(owner: Owner) {\n      super(owner, manager);\n    }\n  };\n}\n","import { registerDestructor } from '@ember/destroyable';\nimport Modifier from 'ember-modifier';\n\nimport type Owner from '@ember/owner';\nimport type { Data, DroppableInput } from '../types.ts';\nimport { DragDropManager, Droppable } from '../types.ts';\n\nexport interface DroppableModifierSignature<T extends Data = Data> {\n  Args: {\n    Named: Omit<DroppableInput<T>, 'element'>;\n  };\n  Element: HTMLElement;\n}\n\nexport class DroppableModifier<T extends Data = Data> extends Modifier<\n  DroppableModifierSignature<T>\n> {\n  private manager: DragDropManager;\n  private droppable?: Droppable<T>;\n\n  constructor(owner: Owner, manager: DragDropManager) {\n    super(owner, {} as never);\n    this.manager = manager;\n    registerDestructor(this, this.cleanup.bind(this));\n  }\n\n  modify(\n    element: HTMLElement,\n    _positional: [],\n    named: DroppableModifierSignature<T>['Args']['Named'],\n  ) {\n    if (this.droppable) {\n      this.droppable.id = named.id;\n      this.droppable.element = element;\n      this.droppable.accept = named.accept;\n      this.droppable.collisionPriority = named.collisionPriority;\n      this.droppable.disabled = !!named.disabled;\n      this.droppable.type = named.type;\n\n      if (named.collisionDetector) {\n        this.droppable.collisionDetector = named.collisionDetector;\n      }\n\n      if (named.data) {\n        this.droppable.data = named.data;\n      }\n    } else {\n      this.droppable = new Droppable({ element, ...named }, this.manager);\n    }\n  }\n\n  private cleanup() {\n    if (this.droppable) {\n      this.droppable.destroy();\n      this.droppable = undefined;\n    }\n  }\n}\n\nexport function createDroppableModifier(\n  manager: DragDropManager,\n): typeof DroppableModifier<Data> {\n  return class BoundDroppableModifier extends DroppableModifier {\n    constructor(owner: Owner) {\n      super(owner, manager);\n    }\n  };\n}\n","import { registerDestructor } from '@ember/destroyable';\nimport Modifier from 'ember-modifier';\n\nimport type Owner from '@ember/owner';\nimport type { Data, SortableInput, UniqueIdentifier } from '../types.ts';\nimport {\n  DragDropManager,\n  Sortable,\n  SortableKeyboardPlugin,\n  defaultSortableTransition,\n} from '../types.ts';\nimport { guidFor } from '@ember/object/internals';\nimport { draggableRegistry, handleRegistry } from './registries.ts';\n\nexport interface SortableModifierSignature<T extends Data = Data> {\n  Args: {\n    Named: Omit<SortableInput<T>, 'element'>;\n  };\n  Element: HTMLElement;\n}\n\nexport class SortableModifier<T extends Data = Data> extends Modifier<\n  SortableModifierSignature<T>\n> {\n  private manager: DragDropManager;\n  private sortable?: Sortable<T>;\n  private currentId?: UniqueIdentifier;\n\n  constructor(owner: Owner, manager: DragDropManager) {\n    super(owner, {} as never);\n    this.manager = manager;\n    registerDestructor(this, this.cleanup.bind(this));\n  }\n\n  get key() {\n    if (!this.currentId) {\n      return '';\n    }\n\n    const managerId = guidFor(this.manager);\n    return `${managerId}_${this.currentId}`;\n  }\n\n  modify(\n    element: HTMLElement,\n    _positional: [],\n    named: SortableModifierSignature<T>['Args']['Named'],\n  ) {\n    this.currentId = named.id;\n\n    if (this.sortable) {\n      this.sortable.id = named.id;\n      this.sortable.element = element;\n      this.sortable.index = named.index;\n      this.sortable.group = named.group;\n      this.sortable.handle = named.handle ?? handleRegistry.get(this.key);\n      this.sortable.type = named.type;\n      this.sortable.accept = named.accept;\n      this.sortable.disabled = named.disabled ?? false;\n      this.sortable.feedback = named.feedback ?? 'default';\n      this.sortable.alignment = named.alignment;\n      this.sortable.modifiers = named.modifiers;\n      this.sortable.sensors = named.sensors;\n      this.sortable.collisionPriority = named.collisionPriority;\n      this.sortable.transition = named.transition ?? defaultSortableTransition;\n\n      if (named.collisionDetector) {\n        this.sortable.collisionDetector = named.collisionDetector;\n      }\n\n      if (named.data) {\n        this.sortable.data = named.data;\n      }\n    } else {\n      this.sortable = new Sortable(\n        {\n          element,\n          // important, eliminates the default OptimisticSortingPlugin, which is not suitable for Ember's rendering model, causing issues with re-rendering\n          // including the SortableKeyboardPlugin by default for keyboard accessibility, seems like a sensible default\n          plugins: [SortableKeyboardPlugin],\n          handle: handleRegistry.get(this.key),\n          ...named,\n        },\n        this.manager,\n      );\n\n      draggableRegistry.set(this.key, this.sortable);\n    }\n  }\n\n  private cleanup() {\n    if (this.sortable) {\n      draggableRegistry.delete(this.key);\n\n      this.sortable.destroy();\n      this.sortable = undefined;\n    }\n  }\n}\n\nexport function createSortableModifier(\n  manager: DragDropManager,\n): typeof SortableModifier<Data> {\n  return class BoundSortableModifier extends SortableModifier {\n    constructor(owner: Owner) {\n      super(owner, manager);\n    }\n  };\n}\n","import { registerDestructor } from '@ember/destroyable';\nimport Modifier from 'ember-modifier';\n\nimport type Owner from '@ember/owner';\nimport type { UniqueIdentifier } from '../types.ts';\nimport { DragDropManager } from '../types.ts';\nimport { guidFor } from '@ember/object/internals';\nimport { draggableRegistry, handleRegistry } from './registries.ts';\n\nexport interface HandleModifierSignature {\n  Args: {\n    Named: {\n      id: UniqueIdentifier;\n    };\n  };\n  Element: HTMLElement;\n}\n\nexport class HandleModifier extends Modifier<HandleModifierSignature> {\n  private manager: DragDropManager;\n  private currentId?: UniqueIdentifier;\n  private element?: HTMLElement;\n\n  constructor(owner: Owner, manager: DragDropManager) {\n    super(owner, {} as never);\n    this.manager = manager;\n    registerDestructor(this, this.cleanup.bind(this));\n  }\n\n  get key() {\n    if (!this.currentId || !this.manager) {\n      return '';\n    }\n\n    const managerId = guidFor(this.manager);\n    return `${managerId}_${this.currentId}`;\n  }\n\n  modify(\n    element: HTMLElement,\n    _positional: [],\n    named: HandleModifierSignature['Args']['Named'],\n  ) {\n    this.element = element;\n    this.currentId = named.id;\n\n    handleRegistry.set(this.key, element);\n    const draggable = draggableRegistry.get(this.key);\n    if (draggable) {\n      draggable.handle = this.element;\n    }\n  }\n\n  private cleanup() {\n    // Clear the handle when the modifier is destroyed\n    if (this.currentId) {\n      handleRegistry.delete(this.key);\n      const draggable = draggableRegistry.get(this.key);\n      if (draggable && draggable.handle === this.element) {\n        draggable.handle = undefined;\n      }\n    }\n  }\n}\n\nexport function createHandleModifier(\n  manager: DragDropManager,\n): typeof HandleModifier {\n  return class BoundHandleModifier extends HandleModifier {\n    constructor(owner: Owner) {\n      super(owner, manager);\n    }\n  };\n}\n","import { registerDestructor } from '@ember/destroyable';\nimport { hash } from '@ember/helper';\nimport { scheduleOnce } from '@ember/runloop';\nimport Component from '@glimmer/component';\nimport { cached } from '@glimmer/tracking';\n\nimport type Owner from '@ember/owner';\nimport type { Data, DragDropEvents, DragDropManagerInput } from '../types.ts';\nimport { DragDropManager } from '../types.ts';\n\nimport {\n  DraggableModifier,\n  createDraggableModifier,\n  DroppableModifier,\n  createDroppableModifier,\n  SortableModifier,\n  createSortableModifier,\n  HandleModifier,\n  createHandleModifier,\n} from '../modifiers/index.ts';\n\nexport interface DragDropSignature {\n  Args: {\n    sensors?: DragDropManagerInput['sensors'];\n    plugins?: DragDropManagerInput['plugins'];\n    modifiers?: DragDropManagerInput['modifiers'];\n    onBeforeDragStart?: DragDropEvents['beforedragstart'];\n    onDragStart?: DragDropEvents['dragstart'];\n    onDragMove?: DragDropEvents['dragmove'];\n    onDragOver?: DragDropEvents['dragover'];\n    onDragEnd?: DragDropEvents['dragend'];\n    onCollision?: DragDropEvents['collision'];\n  };\n  Blocks: {\n    default: [\n      {\n        draggable: typeof DraggableModifier<Data>;\n        droppable: typeof DroppableModifier<Data>;\n        sortable: typeof SortableModifier<Data>;\n        handle: typeof HandleModifier;\n        manager: DragDropManager;\n      },\n    ];\n  };\n}\n\nexport default class DragDrop extends Component<DragDropSignature> {\n  private manager: DragDropManager;\n  private cleanupFns: (() => void)[] = [];\n\n  constructor(owner: Owner, args: DragDropSignature['Args']) {\n    super(owner, args);\n\n    const options: DragDropManagerInput = {};\n    if (this.args.sensors) options.sensors = this.args.sensors;\n    if (this.args.plugins) options.plugins = this.args.plugins;\n    if (this.args.modifiers) options.modifiers = this.args.modifiers;\n\n    this.manager = new DragDropManager(options);\n\n    // Integrate with Ember's runloop for proper rendering coordination\n    this.manager.renderer = {\n      get rendering() {\n        return new Promise<void>((resolve) => {\n          // eslint-disable-next-line ember/no-runloop\n          scheduleOnce('render', null, resolve);\n        });\n      },\n    };\n\n    // Set up event listeners\n    if (this.args.onBeforeDragStart) {\n      const cleanup = this.manager.monitor.addEventListener(\n        'beforedragstart',\n        this.args.onBeforeDragStart as () => void,\n      );\n      this.cleanupFns.push(cleanup);\n    }\n\n    if (this.args.onDragStart) {\n      const cleanup = this.manager.monitor.addEventListener(\n        'dragstart',\n        this.args.onDragStart as () => void,\n      );\n      this.cleanupFns.push(cleanup);\n    }\n\n    if (this.args.onDragMove) {\n      const cleanup = this.manager.monitor.addEventListener(\n        'dragmove',\n        this.args.onDragMove as () => void,\n      );\n      this.cleanupFns.push(cleanup);\n    }\n\n    if (this.args.onDragOver) {\n      const cleanup = this.manager.monitor.addEventListener(\n        'dragover',\n        this.args.onDragOver as () => void,\n      );\n      this.cleanupFns.push(cleanup);\n    }\n\n    if (this.args.onDragEnd) {\n      const cleanup = this.manager.monitor.addEventListener(\n        'dragend',\n        this.args.onDragEnd as () => void,\n      );\n      this.cleanupFns.push(cleanup);\n    }\n\n    if (this.args.onCollision) {\n      const cleanup = this.manager.monitor.addEventListener(\n        'collision',\n        this.args.onCollision as () => void,\n      );\n      this.cleanupFns.push(cleanup);\n    }\n\n    registerDestructor(this, this.cleanup.bind(this));\n  }\n\n  private cleanup() {\n    for (const fn of this.cleanupFns) {\n      fn();\n    }\n    this.cleanupFns = [];\n    this.manager.destroy();\n  }\n\n  @cached\n  get draggableModifier(): typeof DraggableModifier<Data> {\n    return createDraggableModifier(this.manager);\n  }\n\n  @cached\n  get droppableModifier(): typeof DroppableModifier<Data> {\n    return createDroppableModifier(this.manager);\n  }\n\n  @cached\n  get sortableModifier(): typeof SortableModifier<Data> {\n    return createSortableModifier(this.manager);\n  }\n\n  @cached\n  get handleModifier(): typeof HandleModifier {\n    return createHandleModifier(this.manager);\n  }\n\n  <template>\n    {{yield\n      (hash\n        draggable=this.draggableModifier\n        droppable=this.droppableModifier\n        sortable=this.sortableModifier\n        handle=this.handleModifier\n        manager=this.manager\n      )\n    }}\n  </template>\n}\n"],"names":["draggableRegistry","Map","handleRegistry","DraggableModifier","Modifier","manager","draggable","currentId","constructor","owner","registerDestructor","cleanup","bind","key","managerId","guidFor","modify","element","_positional","named","id","handle","get","type","feedback","disabled","sensors","data","Draggable","set","delete","destroy","undefined","createDraggableModifier","BoundDraggableModifier","DroppableModifier","droppable","accept","collisionPriority","collisionDetector","Droppable","createDroppableModifier","BoundDroppableModifier","SortableModifier","sortable","index","group","alignment","modifiers","transition","defaultSortableTransition","Sortable","plugins","SortableKeyboardPlugin","createSortableModifier","BoundSortableModifier","HandleModifier","createHandleModifier","BoundHandleModifier","DragDrop","Component","cleanupFns","args","options","DragDropManager","renderer","rendering","Promise","resolve","scheduleOnce","onBeforeDragStart","monitor","addEventListener","push","onDragStart","onDragMove","onDragOver","onDragEnd","onCollision","fn","draggableModifier","n","prototype","cached","droppableModifier","sortableModifier","handleModifier","setComponentTemplate","precompileTemplate","strictMode","scope","hash"],"mappings":"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"}